import React, { useState } from 'react';
import { Box, Button, CircularProgress, Grid, Tooltip } from '@mui/material';
import { CircleSpinnerOverlay } from 'react-spinner-overlay';
import { useFormik } from 'formik';
import dayjs from 'dayjs';

const InterestRateDailyForm = () => {
  const [loading, setLoading] = useState(false);
  const [submitted, setSubmitted] = useState(false);

  const formik = useFormik({
    initialValues: {
      businessDate: dayjs().format('YYYYMMDD'),
    },
    onSubmit: async (values) => {
      setLoading(true);
      setSubmitted(false);

      // Simulate a 30-second server response delay
      await new Promise((resolve) => setTimeout(resolve, 30000));

      setLoading(false);
      setSubmitted(true);
    },
  });

  return (
    <>
      <CircleSpinnerOverlay
        loading={loading}
        overlayColor="rgba(255, 255, 255, 0.5)"
        spinnerColor="#00BFFF"
        size={60}
      />
      <Box sx={{ position: 'relative', zIndex: 1 }}>
        <form onSubmit={formik.handleSubmit}>
          <Grid container spacing={2}>
            <Grid item xs={12}>
              <Tooltip title="Enter or select the Business Date" arrow>
                <input
                  type="date"
                  name="businessDate"
                  value={formik.values.businessDate}
                  onChange={formik.handleChange}
                  required
                />
              </Tooltip>
            </Grid>
            <Grid item xs={12}>
              <Button type="submit" variant="contained" color="primary" disabled={loading}>
                {loading ? <CircularProgress size={24} /> : 'Recalculate and Resend'}
              </Button>
            </Grid>
          </Grid>
        </form>
        {submitted && <p>Request has been submitted</p>}
      </Box>
    </>
  );
};

export default InterestRateDailyForm;
